<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Restaurant Listing</title>
    <!-------------------------------- link href start -------------------------------->
    <!-- mapbox library import -->
    <link
      rel="stylesheet"
      href="https://api.mapbox.com/mapbox-gl-js/v2.6.1/mapbox-gl.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>
    <!-------------------------------- link href complete -------------------------------->
    <!-------------------------------- scripts start -------------------------------->
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.6.1/mapbox-gl.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <script>
      let marker = [];
      let popups = [];
      let map = null;

      $(document).ready(function () {
        mapboxgl.accessToken =
          "pk.eyJ1Ijoiam9jaG9pMDcwNyIsImEiOiJjajczMWZrcTkwNHo2MzNvNGIzOHI3MW85In0.GSHlVF_HltDmEvomI2m_CA";
        const map = new mapboxgl.Map({
          container: "map",
          center: [-122.420679, 37.772537],
          zoom: 13,
          style: "mapbox://styles/mapbox/streets-v11",
          hash: true,
          transformRequest: (url, resourceType) => {
            if (resourceType === "Source" && url.startsWith("http://myHost")) {
              return {
                url: url.replace("http", "https"),
                headers: { "my-custom-header": true },
                credentials: "include",
              };
            }
          },
        });

        let nav = new mapboxgl.NavigationControl({
          visulizePitch: true,
        });
        map.addControl(nav, "bottom-right");

        const make = new mapboxgl.Marker()
          .setLngLat([-122.420679, 37.772537])
          .addTo(map);

        const popup = new mapboxgl.Popup({
          offset: {
            bottom: [0, -35],
          },
        })
          .setLngLat([-122.420679, 37.772537])
          .setHTML("<h5>Berhasil :)</h5>")
          .setMaxWidth("200px")
          .addTo(map);

        let marker = [];
        let popups = [];

        $("#add-popup-button").on("click", function () {
          const newMarker = new mapboxgl.Marker()
            .setLngLat(map.getCenter())
            .addTo(map);

          marker.push(newMarker);

          const newPopup = new mapboxgl.Popup({
            offset: {
              bottom: [0, -35],
            },
          })
            .setLngLat(map.getCenter())
            .setHTML("<h2>new</h2>")
            .setMaxWidth("300px")
            .addTo(map);

          popups.push(newPopup);
        });

        $("#remove-popups-button").on("click", function () {
          popups.forEach((popup) => popup.remove());
          marker.forEach((m) => m.remove());
          popups = [];
          marker = [];
        });
      });
    </script>
    <!-------------------------------- scripts complete -------------------------------->
    <!-------------------------------- CSS start -------------------------------->
    <style>
      #map {
        width: 100%;
        height: 400px;
      }
    </style>
    <!-------------------------------- CSS complete -------------------------------->
  </head>
  <!-------------------------------- Body start -------------------------------->
  <body>
    <div id="map"></div>
    <br />
    <button id="add-popup-button" class="btn btn-primary">
      Add Marker and Popup
    </button>
    <button id="remove-popups-button" class="btn btn-danger">
      Clear elements
    </button>
    <br />
    <br />
    <p class="text-center">
      Geser Terlebih Dahulu, Agar Ketika Add Popus Muncul di Tempat Berbeda
    </p>
  </body>
  <!-------------------------------- body complete -------------------------------->
</html>
